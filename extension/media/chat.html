<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="{{styles}}">
</head>
<body>
  <div id="chat"><div class="msg bot">ðŸš€ RaaS Chat ready!</div></div>
  <div id="inputRow">
    <textarea id="input" rows="2" placeholder="Type hereâ€¦"></textarea>
    <button id="clip" title="Attach files">ðŸ“Ž</button>
    <button id="send">Send</button>
  </div>
  <script>
    const vscode = acquireVsCodeApi();
    let pickFile = false;

    const chat = document.getElementById('chat');
    const input = document.getElementById('input');
    const send = document.getElementById('send');
    const clip = document.getElementById('clip');

    function push(text, cls){
      const d = document.createElement('div');
      d.className = 'msg '+cls;
      d.textContent = text;
      chat.appendChild(d);
      chat.scrollTop = chat.scrollHeight;
    }

    function sendMsg(){
      const text = input.value.trim();
      if(!text) return;
      push(text, 'user');
      input.value = '';
      push('Generatingâ€¦', 'bot load');
      vscode.postMessage({ type: 'chat', text, pickFile });
      pickFile = false;
    }

    send.onclick = sendMsg;
    input.addEventListener('keydown', e => {
      if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); sendMsg(); }
    });
    clip.onclick = () => { pickFile = true; sendMsg(); };

    window.addEventListener('message', ev => {
      const m = ev.data || {};
      if(m.type==='response'){
        const last = chat.lastElementChild;
        if(last && last.classList.contains('load')) last.remove();
        push(m.text, m.success ? 'bot' : 'err');
      }
    });
  </script>
</body>
</html>
